<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>white-paper - orientsoft</title>

  <link rel="shortcut icon" href="/styles/images/favicon.jpg">
  <link rel="icon" href="/styles/images/favicon.jpg">

  <link rel="stylesheet" href="/styles/css/index.css">
  <link rel="stylesheet" href="/styles/css/fontawesome/css/font-awesome.min.css">
  <link rel="stylesheet" href="/styles/css/syntax.css">
  <link rel="canonical" href="/2017/06/23/white-paper/">
  <link rel="alternate" type="application/rss+xml" title="orientsoft" href="/feed.xml">

  <meta name="keywords" content="white-paper, orientsoft, 康志华;个人博客;学而不思则罔;思而不学则殆;生命不止;折腾不休">
  <meta name="description" content="康志华;个人博客;学而不思则罔;思而不学则殆;生命不止;折腾不休">

  <script src="/styles/js/jquery.min.js"></script>
  <!--[if lt IE 9]>
  <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?94be4b0f9fc5d94cc0d0415ea6761ae9";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>
  <style type="text/css">
    .docs-content{
      margin-bottom: 10px;
    }
  </style>
</head>

<body class="index">

<header class="navbar navbar-inverse navbar-fixed-top docs-nav" role="banner">
  <div class="container">
    <div class="navbar-header">
      <button class="navbar-toggle" type="button" data-toggle="collapse" data-target=".bs-navbar-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a href="/" class="navbar-brand">
        <img src="/styles/images/logo.png">
      </a>
    </div>
    <nav class="collapse navbar-collapse bs-navbar-collapse" role="navigation">
      <ul class="nav navbar-nav">
        <!--<li>-->
        <!--<a href="/">Home</a>-->
        <!--</li>-->
        <li>
          <a href="/categories/">Home</a>
        </li>
        <!--<li>-->
        <!--<a href="/tag">小类内聚</a>-->
        <!--</li>-->
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <!--<li>-->
        <!--<a><span id="busuanzi_container_site_pv">本站总访问量<span id="busuanzi_value_site_pv"></span>次</span></a>-->
        <!--</li>-->
        <!--<li>-->
        <!--<a href="/donate/"><strong>打赏</strong></a>-->
        <!--</li>-->
        <!--<li class="dropdown">-->
        <!--<a href="#" class="dropdown-toggle" data-toggle="dropdown">关于<b class="caret"></b></a>-->
        <!--<ul class="dropdown-menu">-->
        <!--<li><a rel="nofollow" target="_blank" href="https://github.com/luoyan35714/">Github</a></li>-->
        <!--<li><a rel="nofollow" target="_blank" href="http://www.hifreud.com/Resume.io/">关于作者</a></li>-->
        <!--<li><a rel="nofollow" href="/books">我的书单</a></li>-->
        <!--<li><a rel="nofollow" href="http://www.hifreud.com/domains/">域名管理</a></li>-->
        <!--<li><a rel="nofollow" href="/reference">推荐博客</a></li>-->
        <!--<li><a href="/feed.xml">RSS订阅</a></li>-->
        <!--<li class="divider"></li>-->
        <!--<li><a rel="nofollow" target="_blank" href="https://github.com/luoyan35714/LessOrMore.git">本项目</a></li>-->
        <!--</ul>-->
        <!--</li>-->
      </ul>
    </nav>
  </div>
</header>
<div class="docs-header" id="content">
  <div class="container">
    
    <!--
      <h1>white-paper</h1>
      <p>Post on Jun 23, 2017 by <a href="/about">orientsoft</a></p>
  -->
    <!--<h1></h1>-->
    
  </div>
</div>


<!--<div class="banner">-->
<!--<div class="container">-->
<!---->
<!--<a href="/categories/#document-ref">document</a>	/-->
<!--&lt;!&ndash;<a href="/tag/#白皮书-ref">白皮书</a>&ndash;&gt;-->
<!---->
<!--</div>-->
<!--</div>-->



<div class="container docs-container">
  <div class="row">
    <div class="col-md-3">
      <div class="sidebar hidden-print" role="complementary">
        <div id="navigation">
  <h1>目录</h1>
  <ul class="nav sidenav">
<!--
    
      
      
      
      

      
        <li><a href="#year_2017">2017</a>
          <ul class="nav">
            <li><a href="#month_2017_June">June</a></li>
      

      
            
          
        
      
    
      
      
      
      

      

      
            </ul>
          </li>
      
    
-->
  </ul>
</div>
      </div>
    </div>
    <div class="col-md-9" role="main">
      <div class="panel docs-content">
        <div class="wrapper">
          <header class="post-header">
            <h1 class="post-title">white-paper</h1>
            <!--
              <p class="post-meta">Jun 23, 2017</p>
            -->
            <div class="meta">Posted on <span class="postdate">Jun 23, 2017</span> By <a target="_blank" href="http://www.hifreud.com">orientsoft</a></div>
            <br />
          </header>
          <article class="post-content">
            <ul id="markdown-toc">
  <li><a href="#section" id="markdown-toc-section">第一章 问题和思路</a>    <ul>
      <li><a href="#section-1" id="markdown-toc-section-1">1.1 数据采集、解析的开发难度问题</a></li>
      <li><a href="#section-2" id="markdown-toc-section-2">1.2 数据采集、解析等自编制脚本的管理问题</a></li>
      <li><a href="#orientsoft" id="markdown-toc-orientsoft">1.3 Orientsoft软件组件状态管控的问题</a></li>
    </ul>
  </li>
  <li><a href="#section-3" id="markdown-toc-section-3">第二章 最佳实践</a>    <ul>
      <li><a href="#section-4" id="markdown-toc-section-4">2.1 数据采集、解析脚本</a></li>
      <li><a href="#section-5" id="markdown-toc-section-5">2.2 脚本管理</a></li>
      <li><a href="#section-6" id="markdown-toc-section-6">2.3 日志管控</a></li>
    </ul>
  </li>
</ul>

<h1 id="section">第一章 问题和思路</h1>

<h2 id="section-1">1.1 数据采集、解析的开发难度问题</h2>

<p><strong>1. 数据采集的难度</strong></p>

<pre><code>  尽量减小对目标系统的干扰  
  平衡采集频率和吞吐量  
  稳定可靠的通信  
</code></pre>

<p><strong>2. 解析的难度</strong></p>

<pre><code>  对数据中的错误具有鲁棒性  
  对于复杂数据的处理能力  
  能够处理嵌套、混合类型的数据  
  对数据采集速度的变化具有缓冲、容纳能力  
</code></pre>

<p><strong>3. 解决思路</strong></p>

<pre><code>  基于远程命令执行和网络文件映射的数据采集  
  在架构方面，将采集器进行抽象（主动、被动）  
  提供解析器模板、框架  
  提供多种通信信道（缓冲、分流、错误信道）  
</code></pre>

<h2 id="section-2">1.2 数据采集、解析等自编制脚本的管理问题</h2>

<p><strong>1. 目前自编制脚本的问题</strong></p>

<pre><code>  缺乏执行状态监控，可靠性难以保证  
  缺乏知识、代码积累  
  缺乏文档支持  
  缺乏配置、部署的管理  
</code></pre>

<p><strong>2. 解决思路</strong></p>

<pre><code>  提供状态监控  
  在状态监控的基础上，提供异常状态重启  
  强制要求文档的代码库  
  提供配置部署选项  
</code></pre>

<h2 id="orientsoft">1.3 Orientsoft软件组件状态管控的问题</h2>

<p><strong>1. 目前Orientsoft软件组件状态的问题</strong></p>

<pre><code>   缺乏状态监控  
   缺乏有效的日志  
</code></pre>

<p><strong>2. 解决思路</strong></p>

<pre><code>   利用conalog ActiveCollector采集组件状态（组件进程的存活、对系统资源的占用）  
   提供日志发布API，由conalog统一管理日志（Rotate、查询、导出）  
</code></pre>

<h1 id="section-3">第二章 最佳实践</h1>

<h2 id="section-4">2.1 数据采集、解析脚本</h2>

<p><strong>1. 数据采集</strong></p>

<pre><code> 对于数据采集脚本，推荐尽量以重复短暂执行模式为主，这类脚本用ActiveCollector来调用  
 获取到的数据不用开Redis通道，直接打印到STDOUT上，并且不用手工分行；如果有错误，直接输出到STDERR上。采集完成进程直接退出  
 需要长期实时采集的数据，推荐用SSHFS映射到本地后，用Filebeat采集到Redis通道上，在Conalog中添加AgentCollector，利用正则表达式过滤出需要的文件名/路径，并发送到指定通道  
</code></pre>

<p><strong>2. 解析脚本</strong></p>

<pre><code> 解析脚本内部一般需要实现某种形式的Buffer，用来应对数据行的切断和数据输入速度的变化  
 同时解析脚本需要特别注意错误状态的恢复，如果陷入错误应该设法回到初始状态  
</code></pre>

<h2 id="section-5">2.2 脚本管理</h2>

<p><strong>1. 知识积累</strong></p>

<pre><code> 项目部署完成，及时上传新脚本到Git  
 添加Collector/Parser的时候尽量编写完善的备注，建议给出数据/结果样本  
</code></pre>

<h2 id="section-6">2.3 日志管控</h2>

<p><strong>1. 日志集中</strong></p>

<pre><code> 推荐使用Conalog提供的Restful API接口直接将日志推送到Conalog  
 编写统一的脚本进行资源状况采集  
</code></pre>

          </article>
        </div>
      </div>
      <div class="panel docs-content">
        <article class="post-content">
          <div class="wrapper">
            


  <div id="cloud-tie-wrapper" class="cloud-tie-wrapper"></div>
<script src="https://img1.cache.netease.com/f2e/tie/yun/sdk/loader.js"></script>
<script>
var cloudTieConfig = {
  url: document.location.href, 
  sourceId: "",
  productKey: "e68668572a574120ad554fab5b49d365",
  target: "cloud-tie-wrapper"
};
var yunManualLoad = true;
Tie.loader("aHR0cHM6Ly9hcGkuZ2VudGllLjE2My5jb20vcGMvbGl2ZXNjcmlwdC5odG1s", true);
</script>




          </div>
        </article>
      </div>
    </div>
  </div>
</div>


<footer class="footer" role="contentinfo">
  <div class="container">
    <p class="copyright">Copyright &copy; 2016-2017 <a href="http://www.hifreud.com/Resume.io/"><code>orientsoft</code></a>.</p>
    <!--<p>Powered by <a href="http://jekyllrb.com">Jekyll</a>, themed from <a href="http://lesscss.cn/">Less</a>, refactored by <a href="http://www.hifreud.com/">Freud Kang</a></p>-->
  </div>
</footer>

<script src="/styles/js/jquery.min.js"></script>
<script src="/styles/js/bootstrap.min.js"></script>
<script src="/styles/js/holder.min.js"></script>
<script src="/styles/js/lessismore.js"></script>
<script src="/styles/js/application.js"></script>
<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

</body>
</html>
